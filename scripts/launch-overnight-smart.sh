#!/bin/bash
# ğŸŒ™ 24-HOUR SMART OVERNIGHT ENRICHMENT

clear
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                                    â•‘"
echo "â•‘          ğŸŒ™ 24-HOUR SMART OVERNIGHT ENRICHMENT ğŸŒ™                 â•‘"
echo "â•‘                                                                    â•‘"
echo "â•‘              FINAL PUSH FOR CLIENT DEMO!                          â•‘"
echo "â•‘                                                                    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ§  SMART SCRAPER FEATURES:"
echo "  âœ… Tests URLs before scraping (no more 404s!)"
echo "  âœ… Tries multiple URL patterns"
echo "  âœ… Falls back to homepage"
echo "  âœ… Resume capability"
echo "  âœ… Only saves quality results (5+ stores)"
echo ""
echo "ğŸ¯ TARGET OVERNIGHT:"
echo "  â€¢ 603 locations (Tiers 1+2+3: 10+ stores each)"
echo "  â€¢ Expected: 150-250 successful enrichments"
echo "  â€¢ Expected stores: 5,000-10,000 new tenants"
echo "  â€¢ Duration: 10-14 hours"
echo ""
echo "ğŸ“Š BY MORNING YOU'LL HAVE:"
echo "  â€¢ 400-500 locations with tenant data (vs 276 now)"
echo "  â€¢ 16,000-21,000 total tenants (vs 11,466 now)"
echo "  â€¢ Ready for KILLER client demo!"
echo ""
read -p "ğŸš€ Press ENTER to launch overnight enrichment..."

cd /Users/mbeckett/Documents/codeprojects/flourish

# Set API key (use your own OpenAI API key from environment or .env file)
export OPENAI_API_KEY="${OPENAI_API_KEY:-your-openai-api-key-here}"

echo ""
echo "ğŸš€ LAUNCHING SMART TENANT ENRICHMENT..."
echo ""

# Run on ALL tiers (10+ stores)
nohup pnpm tsx scripts/enrich-smart-tenants.ts all > /tmp/smart-tenants-overnight.log 2>&1 &
PID=$!

echo "âœ… Smart enrichment launched! PID: $PID"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“Š WHAT'S RUNNING:"
echo "   Target: 603 locations (10+ stores, with websites, no tenants)"
echo "   Strategy: Smart URL detection + AI scraping"
echo "   Duration: ~10-14 hours"
echo ""
echo "ğŸ’¡ MONITORING:"
echo "   Quick check:  bash scripts/check-smart-progress.sh"
echo "   Live tail:    tail -f /tmp/smart-tenants-overnight.log"
echo "   Auto-refresh: watch -n 60 bash scripts/check-smart-progress.sh"
echo ""
echo "ğŸ“ PROGRESS FILE:"
echo "   /tmp/smart-tenants-progress.json"
echo ""
echo "â¸ï¸  TO PAUSE:"
echo "   pkill -f 'enrich-smart-tenants'"
echo ""
echo "â–¶ï¸  TO RESUME (if paused):"
echo "   cd $PWD"
echo "   export OPENAI_API_KEY=\"your_key\""
echo "   pnpm tsx scripts/enrich-smart-tenants.ts all"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸŒ™ GO TO SLEEP! CHECK RESULTS IN THE MORNING!"
echo ""
echo "ğŸ¯ Expected by morning:"
echo "   â€¢ 150-250 new locations enriched"
echo "   â€¢ 5,000-10,000 new tenants added"
echo "   â€¢ Total: 400-500 locations with tenant data"
echo "   â€¢ Total: 16,000-21,000 tenants"
echo ""
echo "ğŸ‰ YOU'LL HAVE THE BEST SHOPPING CENTER DATABASE IN THE UK!"
echo ""

